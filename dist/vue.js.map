{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["//重新数组的部分方法\n\nlet oldArrayProto = Array.prototype\n\n//newArrayProto.__proto__ = oldArrayProto,不用担心原数组方法被重写\nlet newArrayProto = Object.create(oldArrayProto)\n\nlet methods = [//快速找到重写方法\n    \"push\",\n    \"pop\",\n    \"shift\",\n    \"unshift\",\n    \"reverse\",\n    \"sort\",\n    \"splice\"\n]\n\nmethods.forEach(method => {\n    newArrayProto[method] = function (...args) {//重写数组方法\n        //this指向arr\n        const result = oldArrayProto[method].call(this, ...args)//内部调原来方法，\n\n        //对新增的属性进行劫持，拿到observeArray\n        let inserted;\n        let ob = this.__ob__;\n        // if (method === \"push\" || method === \"unshift\") {\n        //     inserted = args\n        // }\n        // if (method === \"splice\") {\n        //     inserted = args.slice(2)\n        // }\n\n        switch (method) {//获取新加的属性\n            case \"push\":\n            case \"unshift\":\n                inserted = args;\n                break;\n            case \"splice\":\n                inserted = args.slice(2);\n            default:\n                break;\n        }\n\n        if (inserted) {\n            ob.observe(inserted)\n        }\n\n        return result\n    }\n})\n\nexport {\n    newArrayProto\n}","import { newArrayProto } from \"./array\"\n\nclass Observe {\n    constructor(data) {\n        Object.defineProperty(data, \"__ob__\", {//设置不可枚举的__ob__,不然会爆站\n            value: this,\n            enumerable: false\n        })\n\n        //data.__ob__ = this//給数据加了一个标识，如果数据上有__ob__,就代表劫持过了，不能在这里写\n        //defineProperty只能劫持已经存在的\n        //遍历data\n        if (Array.isArray(data)) {//判断是数组还是对象\n            data.__proto__ = newArrayProto//重写数组的部分（7个）方法,保留数组原有的方法\n\n            this.observeArray(data)\n        } else {\n            this.walk(data)\n        }\n    }\n    walk(data) {\n        //重新定义，性能差\n        Object.keys(data).forEach(key => {\n            defineReactive(data, key, data[key])//属性劫持\n        })\n    }\n    observeArray(data) {\n        data.forEach(item => {\n            observe(item)//数组遍历劫持\n        })\n    }\n}\n\nexport function defineReactive(target, key, value) {//闭包\n    observe(value)//值是对象，再次进行属性劫持\n    Object.defineProperty(target, key, {\n        get() {//取值\n            return value\n        },\n        set(newValue) {//设置值\n            if (newValue === value) return\n            observe(value)\n            value = newValue\n        }\n    })\n}\n\nexport function observe(data) {\n    //对对象进行数据劫持\n    //判断是否是对象\n    if (typeof data != \"object\" || data == null) {\n        return\n    }\n    if (data.__ob__ instanceof Observe) {//说明对象被代理过\n        return data.__ob__\n    }\n\n    return new Observe(data)\n}","import { observe } from \"./observe/index\";\n\n//import (observer)\n\nexport function initState(vm) {\n    const opts = vm.$option;\n    if (opts.data) {\n        initData(vm)\n    }\n}\nfunction proxy(vm, target, key) {\n    Object.defineProperty(vm, key, {\n        get() {\n            return vm[target][key]\n        },\n        set(newValue) {\n            vm[target][key] = newValue\n        }\n    })\n}\n\nfunction initData(vm) {\n    let data = vm.$option.data;//用户数据,data可能是函数，或对象\n    data = typeof data === \"function\" ? data.call(vm) : data;\n    //console.log(data)\n\n    vm._data = data//返回对象到_data\n\n    observe(data)//defineProperty劫持\n\n    //将vm._data用vm代理\n    for (let key in data) {\n        proxy(vm, \"_data\", key)\n    }\n}","import { initState } from \"./state\"\n\nexport function initMixin(Vue) {//給Vue增加init方法\n    Vue.prototype._init = function (options) {//options用户选项\n        const vm = this\n        vm.$option = options//Vue自己的属性\n\n        initState(vm)//初始化状态\n    }\n}\n\n","import { initMixin } from \"./init\"\n\nfunction Vue(options) {//options用户选项\n    this._init(options)\n}\n\ninitMixin(Vue)//扩展init方法\n\n\nexport default Vue"],"names":[],"mappings":"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"}